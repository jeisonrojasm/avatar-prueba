<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.min.js"
        integrity="sha512-n8IpKWzDnBOcBhRlHirMZOUvEq2bLRMuJGjuVqbzUJwtTsgwOgK5aS0c1JA647XWYfqvXve8k3PtZdzpipFjgg=="
        crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/fflate"></script>
    <!-- AFRAME EXTRAS (para animaciones)-->
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/FBXLoader.js"></script>
    <script src="https://unpkg.com/three@0.126.0/examples/js/loaders/GLTFLoader.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>
    <!-- <a-scene>
        <a-entity gltf-model="../assets/animacion.glb" scale="2 2 2" position="0 0 -3" animation-mixer></a-entity>
    </a-scene> -->
    <script>
        // Crear la escena, la c치mara y el renderizador
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();

        // Configurar el tama침o del renderizador y agregarlo al cuerpo del HTML
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Agregar una luz a la escena
        var light = new THREE.AmbientLight(0xffffff); // Luz blanca ambiental
        scene.add(light);

        // Crear la variable mixer
        var mixer = new THREE.AnimationMixer(scene);

        // Cargar los archivos glb
        var loader = new THREE.GLTFLoader();
        loader.load('./assets/animacion.glb', function (animacion) {
            loader.load('./assets/modelo.glb', function (modelo) {

                // Obtener las animaciones de cada archivo glb
                var animacionesModelo = modelo.animations;
                var animacionesAnimacion = animacion.animations;

                // Agregar el modelo a la escena
                scene.add(modelo.scene);

                // Reproducir la animaci칩n en bucle
                var actionAnimacion = mixer.clipAction(animacionesAnimacion[0]);
                actionAnimacion.play();
                actionAnimacion.setLoop(THREE.LoopRepeat);

                // Obtener el objeto Mixer del modelo
                var mixerModelo = new THREE.AnimationMixer(modelo.scene);

                // Mezclar las animaciones del modelo y la animaci칩n cargada
                if (animacionesModelo && animacionesModelo.length) {
                    var actionModelo = mixerModelo.clipAction(animacionesModelo[0]);
                    actionModelo.play();
                    actionModelo.setLoop(THREE.LoopRepeat);
                    mixer = THREE.AnimationMixer(scene);
                    mixer.addEventListener('loop', function (event) {
                        if (event.action === actionModelo) {
                            mixer.stopAllAction();
                            mixer.clipAction(animacionesAnimacion[0]).play();
                        }
                    });
                    mixer = THREE.AnimationMixer(scene);
                    mixer.addEventListener('loop', function (event) {
                        if (event.action === actionAnimacion) {
                            mixer.stopAllAction();
                            mixerModelo.clipAction(animacionesModelo[0]).play();
                        }
                    });
                }

                camera.position.z = 5;
                var clock = new THREE.Clock();
                function animate() {
                    requestAnimationFrame(animate);

                    // Actualizar el objeto Mixer con el tiempo transcurrido
                    mixer.update(clock.getDelta());

                    renderer.render(scene, camera);
                }
                animate();

            }, undefined, function (error) {
                console.error(error);
            });
        });

    </script>
</body>

</html>